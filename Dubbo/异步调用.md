# 异步调用

使用Future实现异步调用，对于无需获取返回值的操作来说不存在问题，但消费者若需要获取到最终的异步执行结果，则会出现问题：消费者在使用Future的get()方法获取返回值时被阻塞。为了解决这个问题，Dubbo又引入了CompletableFuture来实现对提供者的异步调用。

从v2.7.0开始，Dubbo的所有异步编程接口开始以CompletableFuture为基础

基于 NIO 的非阻塞实现并行调用，客户端不需要启动多线程即可完成并行调用多个远程服务，相对多线程开销较小。

![image-20191103230408501](https://tva1.sinaimg.cn/large/006y8mN6gy1g8l90np8kyj30y80ayq9q.jpg)

- 用户线程调用方法，比如findXXX，请求远程服务
- IOThread设置一个Future到RpcContext中
- 用户线程获取该Future，并且通过get()方法获取结果，导致用户线程阻塞挂起
- 远程服务返回结果
- IOThread把结果写入Future中，并且唤醒用户线程
- 用户线程获取结果



CompletableFuture最大的优点就是回调。在获取到结果之后，回调用户线程。这样子用户线程可以无需阻塞等待，而是在远程方法执行完毕后，在回调中获取结果。