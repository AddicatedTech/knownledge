# 集群管理

应用集群中，我们常常需要让**每一个机器知道集群中哪些机器是活着的**，并且在集群机器因为宕机，网络断开等原因能够不在人工介入的情况下迅速通知到每一个机器。

Zookeeper 能够很容易的实现集群管理的功能，如有多台 Server 组成一个服务集群，那么必须要一个"总管"知道当前集群中每台机器的服务状态，一旦有机器不能提供服务，集群中其它集群必须知道，**从而做出调整重新分配服务策略**。同样当增加集群的服务时，就会增加一台或多台 Server，同样也必须让"总管"知道，这就是ZooKeeper的集群监控功能。



利用ZooKeeper中两个特性，就可以实现集群机器存活性监控系统：

- 客户端在节点上注册一个Watcher，那么如果该节点变化了，会通知该客户端。

- 创建临时节点，一旦客户端和服务器的会话结束或过期，那么该节点就会消失。



![image-20191019175529291](https://tva1.sinaimg.cn/large/006y8mN6gy1g83nsvhy6wj30u00vqdjz.jpg)



比如我在zookeeper服务器端有一个znode叫/Configuration，那么集群中每一个机器启动的时候都去这个节点下创建一个临时节点，比如server1创建/Configuration /Server1，server2创建/Configuration /Server2，然后Server1和Server2都watch /Configuration 这个父节点，那么也就是这个父节点下数据或者子节点变化都会通知对该节点进行watch的客户端。因为临时节点有一个很重要的特性，就是客户端和服务器端连接断掉或者session过期就会使节点消失，那么在某一个机器挂掉或者断链的时候，其对应的节点就会消
失，然后集群中所有对/Configuration进行watch的客户端都会收到通知，然后取得最新列表即可。



## 参考

http://blog.itpub.net/31509949/viewspace-2218265/