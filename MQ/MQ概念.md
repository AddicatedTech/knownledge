# MQ概念



## MQ是干嘛的

消息总线（Message Queue），后文称MQ，是一种跨进程的通信机制，用于上下游传递消息。

![image-20191030112153291](https://tva1.sinaimg.cn/large/006y8mN6gy1g8g28ru5n7j30tq0ycwol.jpg)

在互联网架构中，MQ是一种非常常见的上下游“逻辑解耦+物理解耦”的消息通信服务。

使用了MQ之后，消息发送上游只需要依赖MQ，逻辑上和物理上都不用依赖其他服务。



## 什么时候不使用MQ

上游实时关注执行结果的时候，不能使用MQ。

既然MQ是互联网分层架构中的解耦利器，那所有通讯都使用MQ岂不是很好？**这是一个严重的误区**，调用与被调用的关系，是无法被MQ取代的。

MQ的**不足**是：

1）系统更复杂，多了一个MQ组件

2）消息传递路径更长，延时会增加

3）消息可靠性和重复性互为矛盾，消息不丢不重难以同时保证

4）上游无法知道下游的执行结果，这一点是很致命的



举个**栗子**：用户登录场景，登录页面调用passport服务，passport服务的执行结果直接影响登录结果，此处的“登录页面”与“passport服务”就必须使用调用关系，而不能使用MQ通信。

无论如何，记住这个**结论**：**调用方实时依赖执行结果的业务场景，请使用调用，而不是MQ**。



## 什么时候使用MQ

- 上游不关心下游执行结果

- 异步返回执行时间长

