# 保证幂等

为保证消息的可达性，超时、重传、确认机制可能导致消息总线、或者业务方**收到重复的消息**，从而对业务产生影响。

举个栗子：

购买会员卡，上游支付系统负责给用户扣款，下游系统负责给用户发卡，通过MQ异步通知。不管是上半场的ACK丢失，导致MQ收到重复的消息，还是下半场ACK丢失，导致购卡系统收到重复的购卡通知，都可能出现，上游扣了一次钱，下游发了多张卡。



为了解决这个问题，必须要定义一个全局的业务ID。比如说工单ID、支付订单ID。消费端根据业务ID进行判断幂等，如果已经处理过该订单了，就不进行处理。

